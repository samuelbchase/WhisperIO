<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/app.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<script src="https://apis.google.com/js/platform.js" async defer></script>
	<meta name="google-signin-client_id" content="1077079919608-rv3bbnguonssfdo11opre6ifugnht8v1.apps.googleusercontent.com">
	<title>WhisperIO Login</title>
</head>
<body style="background: palevioletred">
<!--- Need to actually encrypt userID--->
<div class="g-signin2" data-onsuccess="onSignIn"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
<script>

    function onSignIn(googleUser) {
        console.log("Begin Sign In Process");
        var profile = googleUser.getBasicProfile();
        console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
        console.log('Name: ' + profile.getName());
        console.log('Image URL: ' + profile.getImageUrl());
        console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.

        var id_token = googleUser.getAuthResponse().id_token;
        //console.log("ID Token: " + id_token);

        socket = io();
        console.log("Sending token: " + id_token);
        socket.emit('verifyToken',id_token);
        socket.on('unknownPerson', function(unknownPerson) {
            var person = prompt("We are now making you an account. Please enter your name. If you name includes a '-' this program will crash irreperably", "Geraldo");
            socket.emit('identifyMyself',person);
        });
        socket.on('authSuccess', function(msg) {
            alert("Auth Success! Hello: " + msg);
            sessionStorage.setItem("whisperIOUser", msg);
            window.location.href = "/main";
        });
        socket.on('authSuccessNewUser', function(msg) {
            alert("Auth Success! Thank you for joining Whisper.io, " + msg);
            sessionStorage.setItem("whisperIOUser", msg);
            window.location.href = "/main";
        });

        socket.on('authFailureAppDiscrepancy', function(msg) {
            alert("Bad Dog! No hacking!");
        });
    }


</script>
</body>
</html>